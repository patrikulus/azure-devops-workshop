# Variables to set in Azure Pipelines:
# SolutionPath: path to .sln file
# Subscription: Azure subscription ID

trigger: 
  - master

pool:
  name: Azure Pipelines
  vmImage: windows-2019

variables:
  ServiceConnection: 'workshop-azure'

jobs:
- job: build-app
  steps:
  - template: templates/build.yml
    parameters:
      solutionPath: $(SolutionPath)

- template: templates/deploy.yml
  dependsOn: [build-app]
  parameters:
    serviceConnection: $(ServiceConnection)
    subscription: $(Subscription)
    resourceGroup: 'workshop-test-pl05'
    appServiceName: 'workshop-test-app-pl05'
    appServicePlanName: 'workshop-test-plan-pl05'

- template: templates/deploy.yml
  dependsOn: [build-app]
  parameters:
    serviceConnection: $(ServiceConnection)
    subscription: $(Subscription)
    resourceGroup: 'workshop-prod-pl'
    appServiceName: 'workshop-prod-app-pl'
    appServicePlanName: 'workshop-prod-plan-pl'
  
    
